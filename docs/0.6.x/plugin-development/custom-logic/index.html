<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">
  
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Plugin Development - Write custom logic - v0.6.x | Kong - Open-Source API Management and Microservice Management</title>
  <meta name="description" content="Secure, Manage & Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more.">
  <meta name="author" content="Mashape"/>
  <meta property="og:title" content="Open-Source API Management and Microservice Management"/>
  <meta property="og:site_name" content="Kong"/>
  <!-- use share link for facebook -->
  <meta property="og:url" content="http://getkong.org"/>
  <meta property="og:description" content="Secure, Manage & Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more."/>
  <meta property="og:type" content="website"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:image" content="https://getkong.org/assets/images/share.png"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:site" content="@mashape"/>
  <meta name="twitter:creator" content="@mashape"/>
  <meta name="twitter:url" content="https://getkong.org"/>
  <meta name="twitter:description" content="Secure, Manage & Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more.">
  <meta name="twitter:image" content="https://getkong.org/assets/images/share.png">
  <meta property="fb:admins" content="227304446"/>
  <meta property="fb:admins" content="576641408"/>
  <meta name="google-site-verification" content="CrU3zp02dNKTe8NSAipL4NCPkrIjDXG8fViTZ-MIzP4"/>
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "Mashape",
      "url": "https://getkong.org",
      "logo": "https://getkong.org/assets/images/logo.png",
      "sameAs": [
        "https://www.facebook.com/Mashape",
        "https://twitter.com/mashape",
        "https://plus.google.com/+mashape"
      ]
    }
  </script>
  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"/>
  <link rel="stylesheet" href="//cloud.typography.com/7506032/804186/css/fonts.css"/>
  <link rel="stylesheet" href="/assets/styles.css?v=1467147631"/>
</head>


  <body id="documentation" >
    <header class="site-header">
  <div class="enterprise">
    <div class="container">
      <nav class="enterprise-sites one-half column">
        <ul>
          <li class="active"><a href="http://getkong.org">Kong</a></li>
          <li><a href="http://gelato.io">Gelato</a></li>
          <li><a href="http://getgalileo.io">Galileo</a></li>
          <li><a href="http://market.mashape.com">Marketplace</a></li>
        </ul>
      </nav>
      <nav class="enterprise-contact one-half column">
        <ul>
          <li><a href="https://www.mashape.com/request-demo/">Request Demo</a></li>
          <li><a href="tel:+18664021473">Sales: +1 (866) 402-1473</a></li>
        </ul>
      </nav>
    </div>
  </div><!-- .enterprise -->
  <div class="navbar">
    <div class="container">
      <a href="/" class="navbar-brand"><img src="/assets/images/branding.svg" alt="Kong" width="99" height="32"></a>
      <iframe class="header-star" src="https://ghbtns.com/github-btn.html?user=Mashape&amp;repo=kong&amp;type=star"frameborder="0" scrolling="0" width="55" height="20"></iframe>
      <button data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar" class="navbar-toggle">
        <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button>
      <nav id="navbar" class="navbar-nav">
        <ul>
          <li><a href="/about/" >About</a></li>
          <li><a href="/docs/"  class="active">Docs</a></li>
          <li><a href="/plugins/" >Plugins</a></li>
          <li><a href="/community/" >Community</a></li>
          <li><a href="/enterprise/" >Enterprise</a></li>
          <li><a href="https://github.com/Mashape/kong" target="_blank">GitHub</a></li>
          <li>
            <a href="/install/" class="button button-dark" data-analytics='{"event": "Clicked download", "type": "button", "location": "header"}'>Installation</a>
          </li>
        </ul>
      </nav>
    </div>
  </div><!-- .navbar -->
</header>


    <header class="page-header">
  <div class="container">
    <div class="page-header-icon">
      <img src="/assets/images/icons/icn-documentation.svg" alt="Documentation" />
    </div>
    <div class="page-header-title">
      <h1>Documentation (0.6.x)</h1>
      <p>Learn how Kong empowers your APIs</p>
    </div>

    
      <div class="dropdown page-header-right">
        <button class="page-header-btn" id="version-dropdown" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Version 0.6.x
          
          <span class="caret"></span>
        </button>

        <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="version-dropdown">
          
            
              <li>
                <a href="/docs/0.2.0-2">
                  0.2.0-2
                  
                </a>
              </li>
            
          
            
              <li>
                <a href="/docs/0.2.x">
                  0.2.x
                  
                </a>
              </li>
            
          
            
              <li>
                <a href="/docs/0.3.x">
                  0.3.x
                  
                </a>
              </li>
            
          
            
              <li>
                <a href="/docs/0.4.x">
                  0.4.x
                  
                </a>
              </li>
            
          
            
              <li>
                <a href="/docs/0.5.x">
                  0.5.x
                  
                </a>
              </li>
            
          
            
          
            
              <li>
                <a href="/docs/0.7.x">
                  0.7.x
                  
                </a>
              </li>
            
          
            
              <li>
                <a href="/docs/0.8.x">
                  0.8.x
                  (latest)
                </a>
              </li>
            
          
        </ul>
      </div>
    
  </div>
</header>

<div class="container">
  <aside class="page-navigation">
    

    
    <nav>
      
      <h5>Getting Started</h5>
      
      <ul>
        
        
        <li>
          <a href="/docs/0.6.x/getting-started/introduction" >Introduction</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/getting-started/quickstart" >Five-minute quickstart</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/getting-started/adding-your-api" >Adding your API</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/getting-started/enabling-plugins" >Enabling Plugins</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/getting-started/adding-consumers" >Adding Consumers</a>
          
        </li>
        
      </ul>
    </nav>
    
    <nav>
      
      <h5>Guides &amp; References</h5>
      
      <ul>
        
        
        <li>
          <a href="/docs/0.6.x/configuration" >Configuration reference</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/cli" >CLI reference</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/clustering" >Clustering reference</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/proxy" >Proxy reference</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/lua-reference/" >Public Lua API reference</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/plugin-development" >Plugin Development Guide</a>
          
          <ul>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development" >Introduction</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/file-structure" >File structure</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/custom-logic" class="active">Implement custom logic</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/plugin-configuration" >Plugin configuration</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/access-the-datastore" >Access the datastore</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/custom-entities" >Store custom entities</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/entities-cache" >Caching custom entities</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/admin-api" >Extending the Admin API</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/tests" >Writing tests</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/plugin-development/distribution" >Distribute your plugin</a>
            </li>
            
          </ul>
          
        </li>
        
      </ul>
    </nav>
    
    <nav>
      
      <a href="/docs/0.6.x/admin-api/"><h5>Admin API</h5></a>
      
      <ul>
        
        
        <li>
          <a href="/docs/0.6.x/admin-api/#supported-content-types" >Supported Content Types</a>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/admin-api/#information-routes" >Information routes</a>
          
          <ul>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#retrieve-node-information" >Retrieve node information</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#retrieve-node-status" >Retrieve node status</a>
            </li>
            
          </ul>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/admin-api/#cluster" >Cluster</a>
          
          <ul>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#retrieve-cluster-status" >Retrieve cluster status</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#forcibly-remove-a-node" >Forcibly remove a node</a>
            </li>
            
          </ul>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/admin-api/#api-object" >API Object routes</a>
          
          <ul>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#add-api" >Add API</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#retrieve-api" >Retrieve API</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#list-apis" >List APIs</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#update-api" >Update API</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#update-or-create-api" >Update or create API</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#delete-api" >Delete API</a>
            </li>
            
          </ul>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/admin-api/#consumer-object" >Consumer Object routes</a>
          
          <ul>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#create-consumer" >Create Consumer</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#retrieve-consumer" >Retrieve Consumer</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#list-consumers" >List Consumers</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#update-consumer" >Update Consumer</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#update-or-create-consumer" >Update or create Consumer</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#delete-consumer" >Delete Consumer</a>
            </li>
            
          </ul>
          
        </li>
        
        
        <li>
          <a href="/docs/0.6.x/admin-api/#plugin-object" >Plugin Object routes</a>
          
          <ul>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#add-plugin" >Add Plugin</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#retrieve-plugin" >Retrieve Plugin</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#list-all-plugins" >List all Plugins</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#list-plugins-per-api" >List Plugins per API</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#update-plugin" >Update Plugin</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#update-or-add-plugin" >Update or Add Plugin</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#delete-plugin" >Delete Plugin</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#retrieve-enabled-plugins" >Retrieve Enabled Plugins</a>
            </li>
            
            
            <li>
              <a href="/docs/0.6.x/admin-api/#retrieve-plugin-schema" >Retrieve Plugin Schema</a>
            </li>
            
          </ul>
          
        </li>
        
      </ul>
    </nav>
    
  </aside>

  <div class="page-content-container">
    <div class="page-content">
      <div class="content">
        
        <div class="alert alert-warning">
          <strong>Careful!</strong> You are browsing documentation for an outdated version of Kong. Go <a href="/docs/latest">here</a> to browse the documentation for the latest version.
        </div>
        

      <h1 id="plugin-development-write-custom-logic">Plugin Development - Write custom logic</h1>

<h4 id="module">Module</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">&quot;kong.plugins.&lt;plugin_name&gt;.handler&quot;
</code></pre></div>
<hr>

<div class="alert alert-warning">
  <strong>Note:</strong> This chapter assumes that you are familiar with <a href="http://www.lua.org/">Lua</a> and the <a href="https://github.com/openresty/lua-nginx-module">lua-nginx-module API</a>.
</div>

<p>Kong allows you to execute custom code at different times in the lifecycle of a request. To do so, you have to implement one or several of the methods of the <code>base_plugin.lua</code> interface. Those methods are to be implemented in a module at: <code>&quot;kong.plugins.&lt;plugin_name&gt;.handler&quot;</code></p>

<hr>

<h3 id="available-request-contexts">Available request contexts</h3>

<p>Kong allowsÂ you to write your code in all of the lua-nginx-module contexts. Each function to implement in your <code>handler.lua</code> file will be executed when the context is reached for a request:</p>

<table><thead>
<tr>
<th>Function name</th>
<th>lua-nginx-module context</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>:init_worker()</code></td>
<td><a href="https://github.com/openresty/lua-nginx-module#init_worker_by_lua">init_worker_by_lua</a></td>
<td>Executed upon every Nginx worker process&#39;s startup.</td>
</tr>
<tr>
<td><code>:certificate()</code></td>
<td>ssl_certificate_by_lua (experimental)</td>
<td>Executed during the SSL certificate serving phase of the SSL handshake. This feature is still experimental and provided when Nginx is patched during Kong&#39;s installation. It should be stabilized soon thanks to the hard work of the lua-nginx-module authors. More information can be found in the related discussion: <a href="https://github.com/openresty/lua-nginx-module/issues/331">openresty/lua-nginx-module#331</a>.</td>
</tr>
<tr>
<td><code>:access()</code></td>
<td><a href="https://github.com/openresty/lua-nginx-module#access_by_lua">access_by_lua</a></td>
<td>Executed for every request upon it&#39;s reception from a client and before it is being proxied to the upstream service.</td>
</tr>
<tr>
<td><code>:header_filter()</code></td>
<td><a href="https://github.com/openresty/lua-nginx-module#header_filter_by_lua">header_filter_by_lua</a></td>
<td>Executed when all response headers bytes have been received from the upstream service.</td>
</tr>
<tr>
<td><code>:body_filter()</code></td>
<td><a href="https://github.com/openresty/lua-nginx-module#body_filter_by_lua">body_filter_by_lua</a></td>
<td>Executed for each chunk of the response body received from the upstream service. Since the response is streamed back to the client, it can exceed the buffer size and be streamed chunk by chunk. hence this method can be called multiple times if the response is large. See the lua-nginx-module documentation for more details.</td>
</tr>
<tr>
<td><code>:log()</code></td>
<td><a href="https://github.com/openresty/lua-nginx-module#log_by_lua">log_by_lua</a></td>
<td>Executed when the last response byte has been sent to the client.</td>
</tr>
</tbody></table>

<p>All of those functions take one parameter given by Kong: the configuration of your plugin. This parameter is a simple Lua table, and will contain values defined by your users, according to the schema of your choice. More on that in the <a href="/docs/0.6.x/plugin-development/plugin-configuration/">next chapter</a>.</p>

<hr>

<h3 id="handler-lua-specifications">handler.lua specifications</h3>

<p>The <code>handler.lua</code> file must return a table implementing the functions you whish to be executed. In favor of brevity, here is a commented example module implementing all the available methods:</p>

<div class="alert alert-warning">
  <strong>Note:</strong> Kong uses the <a href="https://github.com/rxi/classic">rxi/classic</a> module to simulate classes in Lua and ease the inheritence pattern.
</div>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- Extending the Base Plugin handler is optional, as there is no real</span>
<span class="c1">-- concept of interface in Lua, but the Base Plugin handler&#39;s methods</span>
<span class="c1">-- can be called from your child implementation and will print logs</span>
<span class="c1">-- in your `error.log` file (where all logs are printed).</span>
<span class="kd">local</span> <span class="n">BasePlugin</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">kong.plugins.base_plugin&quot;</span>
<span class="kd">local</span> <span class="n">CustomHandler</span> <span class="o">=</span> <span class="n">BasePlugin</span><span class="p">:</span><span class="n">extend</span><span class="p">()</span>

<span class="c1">-- Your plugin handler&#39;s constructor. If you are extending the</span>
<span class="c1">-- Base Plugin handler, it&#39;s only role is to instanciate itself</span>
<span class="c1">-- with a name. The name is your plugin name as it will be printed in the logs.</span>
<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">my-custom-plugin&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">init_worker</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="c1">-- Eventually, execute the parent implementation</span>
  <span class="c1">-- (will log that your plugin is entering this context)</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">init_worker</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

  <span class="c1">-- Implement any custom logic here</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">certificate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="c1">-- Eventually, execute the parent implementation</span>
  <span class="c1">-- (will log that your plugin is entering this context)</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">certificate</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

  <span class="c1">-- Implement any custom logic here</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">access</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="c1">-- Eventually, execute the parent implementation</span>
  <span class="c1">-- (will log that your plugin is entering this context)</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">access</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

  <span class="c1">-- Implement any custom logic here</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">header_filter</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="c1">-- Eventually, execute the parent implementation</span>
  <span class="c1">-- (will log that your plugin is entering this context)</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">header_filter</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

  <span class="c1">-- Implement any custom logic here</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">body_filter</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="c1">-- Eventually, execute the parent implementation</span>
  <span class="c1">-- (will log that your plugin is entering this context)</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">body_filter</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

  <span class="c1">-- Implement any custom logic here</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">log</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="c1">-- Eventually, execute the parent implementation</span>
  <span class="c1">-- (will log that your plugin is entering this context)</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

  <span class="c1">-- Implement any custom logic here</span>
<span class="k">end</span>

<span class="c1">-- This module needs to return the created table, so that Kong</span>
<span class="c1">-- can execute those functions.</span>
<span class="k">return</span> <span class="n">CustomHandler</span>
</code></pre></div>
<p>Of course, the logic of your plugin itself can be abstracted away in another module, and called from your <code>handler</code> module. Many existing plugins have already chosen this pattern when their logic is verbose, but it is purely optional:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">BasePlugin</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">kong.plugins.base_plugin&quot;</span>

<span class="c1">-- The actual logic is implemented in those modules</span>
<span class="kd">local</span> <span class="n">access</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">kong.plugins.my-custom-plugin.access&quot;</span>
<span class="kd">local</span> <span class="n">body_filter</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">kong.plugins.my-custom-plugin.body_filter&quot;</span>

<span class="kd">local</span> <span class="n">CustomHandler</span> <span class="o">=</span> <span class="n">BasePlugin</span><span class="p">:</span><span class="n">extend</span><span class="p">()</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">my-custom-plugin&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">access</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">access</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

  <span class="c1">-- Execute any function from the module loaded in `access`,</span>
  <span class="c1">-- for example, `execute()` and passing it the plugin&#39;s configuration.</span>
  <span class="n">access</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">CustomHandler</span><span class="p">:</span><span class="n">body_filter</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="n">CustomHandler</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">body_filter</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

  <span class="c1">-- Execute any function from the module loaded in `body_filter`,</span>
  <span class="c1">-- for example, `execute()` and passing it the plugin&#39;s configuration.</span>
  <span class="n">body_filter</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">CustomHandler</span>
</code></pre></div>
<hr>

<h3 id="plugins-execution-order">Plugins execution order</h3>

<div class="alert alert-warning">
  <strong>Note:</strong> This is still a work-in-progress API. For thoughts on how plugins execution order should be configurable in the future, see <a href="https://github.com/Mashape/kong/issues/267">Mashape/kong#267</a>.
</div>

<p>Some plugins might depend on the execution of others to perform some operations. For example, plugins relying on the identity of the consumer have to run <strong>after</strong> authentication plugins. Considering this, Kong defines <strong>priorities</strong> between plugins execution to ensure that order is respected.</p>

<p>Your plugin&#39;s priority can be configured via a property accepting a number in the returned handler table:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">CustomHandler</span><span class="p">.</span><span class="n">PRIORITY</span> <span class="o">=</span> <span class="mi">10</span>
</code></pre></div>
<p>The higher the priority, the sooner your plugin&#39;s phases will be executed in regard to other plugins&#39; phases (such as <code>:access()</code>, <code>:log()</code>, etc...). The current authentication plugins have a priority of <code>1000</code>.</p>

<hr>

<p>Next: <a href="/docs/0.6.x/plugin-development/plugin-configuration/">Store configuration &rsaquo;</a></p>

      </div>
    </div>
  </div>
</div>


    <footer class="footer">
  
    <section class="section subscribe-section" id="newsletter">
  <div class="container">
    <header class="section-header">
      <h4>Keep up with the latest features</h4>
    </header>


    <form action="/" class="subscribe-form">
      <div class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
      </div>

      <div class="alert alert-success" role="alert">Thank You!</div>

      <div class="input-group">
        <input type="email" name="email" placeholder="youre@awesome.com" required/>
        <button class="button button-primary" type="submit">Subscribe</button>
      </div>
    </form>
  </div>
</section>

  

  <div class="footer-bar">
    <div class="container">
      <ul class="footer-social">
        <li>
          <!-- verse link.web with link.share in the header -->
          <div class="fb-share-button" data-href="https://getkong.org" data-layout="button"></div>
        </li>
        <li>
          <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://getkong.org" data-text="KONG - the open-source management layer for APIs and Microservices" data-hashtags="opensource,API,management">Tweet</a>
        </li>
        <li>
          <a class="github-button" href="https://github.com/Mashape/kong" data-icon="octicon-star" data-count-href="/mashape/kong/stargazers" data-count-api="/repos/mashape/kong#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star mashape/kong on GitHub">Star</a>
        </li>
        <li>
          <iframe src="//www.yvoschaap.com/producthunt/counter.html#href=http://getkong.org&amp;layout=wide" width="120" height="25" scrolling="no" frameborder="0" allowtransparency="true"></iframe>
        </li>
      </ul>
    <span>
      <a href="https://mashape.com">
        <img src="/assets/images/branding-footer.svg" alt="Mashape" width="22" height="26"/>
        &copy; <strong>2016 Mashape Inc</strong>
      </a>
    </span>
      <span class="footer-separator"></span>
      <span class="footer-nav">
        <a href="/license">License</a>
        <a href="/terms">Terms</a>
        <a href="/privacy">Privacy</a>
        <a href="/enterprise">Enterprise</a>
        <a href="http://blog.mashape.com/category/open-source/" target="_blank">News</a>
      </span>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/assets/app.js?v=1467147631"></script>

    <div id="fb-root"></div>

    <a id="support-bubble" href="https://gitter.im/Mashape/kong" class="js-gitter-toggle-chat-button" data-gitter-toggle-chat-state="true"></a>

    <script id="github-bjs" src="https://buttons.github.io/buttons.js" async defer></script>
    <script id="twitter-wjs" type="text/javascript" src="https://platform.twitter.com/widgets.js" async defer></script>
    <script id="facebook-jssdk" type="text/javascript" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=842731852424506" async defer></script>

    <script type='text/javascript'>
      var _vwo_code=(function(){
      var account_id=125292,
      settings_tolerance=2000,
      library_tolerance=2500,
      use_existing_jquery=true,
      // DO NOT EDIT BELOW THIS LINE
      f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
    </script>

    <script type="text/javascript">
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
        analytics.load("WDj0nSS7hpyxwL3evgbOzK755s0NUye6");
        analytics.page()
      }}();
    </script>

    <script type="text/javascript" src="//mashape.github.io/notification-bar/embed.js" async defer></script>
    <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
  </body>
</html>
